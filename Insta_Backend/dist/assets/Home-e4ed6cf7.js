import{j as e,P as L,u as I,a as k,b as se,N as te,c as m,h as F,d as $,e as ae,f as re,r,g as ie,S as ne,i as oe,k as ce,m as z,n as H,o as le}from"./index-9394af83.js";const de=()=>e.jsx("div",{className:"topBar",children:e.jsx("div",{className:"instagramBrand",children:e.jsx("h3",{children:"InstaClone"})})}),W=({item:s})=>{const c=I(),{suggestedUsers:n}=k(h=>h.User),d=async()=>{const{data:h}=await m.patch("/addFollowing",{user:s._id});c(F(h.following));const l=n.filter(g=>g._id!==s._id);c($(l))};return e.jsxs("div",{className:"suggestedUserCard",children:[e.jsx("div",{className:"suggestedUserCard1",children:e.jsx("img",{src:s.profile?s.profile.url:se})}),e.jsxs("div",{className:"suggestedUserCard2",children:[e.jsx(te,{to:`/profile/${s._id}`,children:s.username}),e.jsxs("p",{children:[s.name," | ",s.followers.length," followers"]})]}),e.jsx("div",{className:"suggestedUserCard3",children:e.jsx("p",{onClick:d,children:"Follow"})})]})};W.propTypes={item:L.object};const O=({page:s,limit:c})=>async n=>{try{n(ae());const{data:d}=await m.get(`/suggestedPosts?page=${s}&limit=${c}`);setTimeout(()=>{n(re(d))},1500)}catch(d){console.log(d)}};const q=({post:s,mute:c,handleMute:n})=>{const d=r.useRef(),h=ie(),l=r.useRef(),[g,C]=r.useState(!1),[N,w]=r.useState(0),[x,b]=r.useState(!0),{user:u}=k(i=>i.User),[y,p]=r.useState(!1),[S,a]=r.useState(!1),[o,j]=r.useState(!1),{device:G}=k(i=>i.App),U=I();var J=Date.parse(new Date().toISOString());let f=J-Date.parse(s.createdAt);const[v,D]=r.useState(0),_=Math.floor(f/(1e3*60*60*24*30*12)),E=Math.floor(f/(1e3*60*60*24*30)),B=Math.floor(f/(1e3*60*60*24*7)),T=Math.floor(f/(1e3*60*60*24)),M=Math.floor(f/(1e3*60*60)),A=Math.floor(f/(1e3*60)),K=Math.floor(f/1e3),Q=_>0?`${_} yr`:E>0?`${E} mo`:B>0?`${B} wk`:T>0?`${T} d`:M>0?`${M} hr`:A>0?`${A} min`:`${K} sec`;r.useEffect(()=>{},[G]),r.useEffect(()=>{g?d.current&&d.current.classList.add("like"):d.current&&d.current.classList.remove("like")},[g]);const V=async()=>{const i={headers:{"Content-Type":"multipart/form-data"}};g===!0&&N>0?(w(t=>t-1),await m.patch(`/dislike/${s._id}`,i)):(w(t=>t+1),await m.patch(`/like/${s._id}`,i)),C(!g)};r.useEffect(()=>{s.likedBy.includes(u._id)&&C(!0),s&&w(s.likes),u&&u.following.find(({user:i})=>i===s.createdBy._id)&&p(!0)},[s,u]);const X=i=>{i.forEach(t=>{t.isIntersecting?(a(!0),t.target.mute=!1,t.target.autoPlay=!0):(a(!1),t.target.autoPlay=!1,t.target.mute=!0,t.target.mute=!0)})};r.useEffect(()=>{let i=l.current;const t={threshold:.9},R=new IntersectionObserver(X,t);return l.current&&R.observe(l.current),l.current&&(S?l.current.play():l.current.pause(),l.current.addEventListener("contextmenu",P=>P.preventDefault())),()=>{i&&(R.unobserve(i),i.removeEventListener("contextmenu",P=>P.preventDefault()))}},[l,S]);const Y=()=>{v<s.posts.length-1&&D(i=>i+1)},Z=()=>{v>0&&D(i=>i-1)},ee=async()=>{if(y){const{data:t}=await m.patch("/removeFollowing",{user:s.createdBy._id});U(F(t.following)),t&&p(!1)}else{const{data:t}=await m.patch("/addFollowing",{user:s.createdBy._id});U(F(t.following)),t&&p(!0)}(async()=>{j(!0);const{data:t}=await m.get("/suggestedUser");U($(t.suggestedUsers)),setTimeout(()=>{j(!1)},[1500])})()};return e.jsxs("div",{className:"postCard",children:[e.jsx("div",{className:"postCard1",children:e.jsxs("div",{className:"postCard11",children:[e.jsx("img",{src:s.createdBy.profile.url,alt:""}),e.jsxs("p",{children:[e.jsxs("span",{onClick:()=>{s.createdBy._id===u._id?h("/profile"):h(`/profile/${s.createdBy._id}`)},children:[s.createdBy.username," "]}),e.jsx("br",{})," ",e.jsxs("span",{children:[Q," ago"]})," "]}),u._id!==s.createdBy._id&&e.jsx("div",{className:"followingDiv",children:e.jsx("p",{onClick:ee,children:y?e.jsx("span",{className:"following",children:"Following..."}):e.jsx("span",{className:"notFollowing",children:"Follow"})})})]})}),e.jsxs("div",{className:"postCard2",children:[s.postType==="reel"?e.jsxs(e.Fragment,{children:[e.jsx("video",{src:s.posts[0].url,ref:l,loop:!0,disablePictureInPicture:!0,controlsList:"nodownload nofullscreen noplaybackrate",muted:c,onClick:()=>n(!c)}),e.jsx("div",{className:"actionDiv",children:c?e.jsx(oe,{className:"muteicon ",onClick:()=>n(!c)}):e.jsx(ne,{className:"unMuteicon ",onClick:()=>n(!c)})})]}):e.jsx(e.Fragment,{children:e.jsx(ce,{item:s.posts[v],mute:c,handleMute:n})}),s.postType=="post"&&s.posts.length>1&&v<s.posts.length-1&&e.jsx("div",{className:"rightArrow",children:e.jsx(z,{onClick:Y})}),s.postType=="post"&&v>0&&e.jsx("div",{className:"leftArrow",children:e.jsx(z,{onClick:Z})}),s.postType=="post"&&s.posts.length>1&&e.jsx("div",{className:"indicesCircle",children:s.posts.map((i,t)=>e.jsx("div",{className:"circles",onClick:()=>{D(t)},style:{backgroundColor:`${v==t?"white":"transparent"}`}},t))})]}),e.jsxs("div",{className:"postCard3",children:[e.jsxs("div",{className:"postCard31",children:[e.jsx("div",{className:"postLikeDiv",ref:d,children:e.jsx(H,{onClick:()=>V()})}),e.jsxs("p",{children:[N," likes"]})]}),e.jsx("p",{onClick:()=>b(!x),className:x?"clamp postCard3Desc":"noclamp postCard3Desc",children:"Lorem ipsum dolor, sit amet consectetur adipisicing elit. Labore, harum. Ea rem nesciunt neque tenetur temporibus dicta voluptatibus est iste accusamus architecto eum rerum ab, necessitatibus corporis voluptates! Libero, suscipit."})]})]})};q.propTypes={post:L.object,mute:L.bool,handleMute:L.func};const ue=()=>e.jsxs("div",{className:"postCard postCardLoader",children:[e.jsx("div",{className:"postCard1 postCardLoader1",children:e.jsxs("div",{className:"postCard11 postCardLoader11",children:[e.jsx("div",{className:"imgDiv"}),e.jsxs("div",{className:"userNameDiv",children:[e.jsx("div",{}),e.jsx("div",{})]})]})}),e.jsx("div",{className:"postCard2 postCardLoader2",children:e.jsx("div",{})}),e.jsxs("div",{className:"postCard3 postCardLoader3",children:[e.jsxs("div",{className:"postCard31 postCardLoader31",children:[e.jsx("div",{className:"postLikeDiv postCardLoader311",children:e.jsx(H,{})}),e.jsx("p",{children:"likes"})]}),e.jsx("p",{className:"postLoaderDesc1"}),e.jsx("p",{className:"postLoaderDesc2"})]})]}),he=()=>{const[s,c]=r.useState(),n=r.useRef(),[d,h]=r.useState(!0),{suggestedUsers:l}=k(a=>a.User),g=I(),[C,N]=r.useState(!1);let w=[0,1,2,3,4];const[x,b]=r.useState(1),{suggestedPosts:u,hasMore:y,loading:p}=k(a=>a.SuggestedPosts);r.useEffect(()=>{function a(){const o=window.innerWidth;o>1439?c("lap"):o>=768&&o<1440?c("tab"):o<768&&c("mob")}return localStorage.getItem("darkmode")||localStorage.setItem("darkmode","disable"),a(),window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[]);const S=a=>{h(a)};return r.useEffect(()=>{const a=async()=>{N(!0);const{data:j}=await m.get("/suggestedUser");g($(j.suggestedUsers)),setTimeout(()=>{N(!1)},[1500])};l.length===0&&a(),(async()=>{g(O({page:x,limit:5}))})()},[]),r.useEffect(()=>{const a=new IntersectionObserver(o=>{o[0].isIntersecting&&!p&&y&&(b(j=>j+1),g(O({page:x+1,limit:5})))},{threshold:.8});return n.current.children[u.length-1]&&a.observe(n.current.children[u.length-1]),()=>{n.current&&n.current.children[u.length-1]&&a.unobserve(n.current.children[u.length-1])}},[n,u.length,p,y,x,g,s]),e.jsxs(le.div,{className:"home",initial:{opacity:0},animate:{opacity:1},exit:{opacity:.5},transition:{ease:"linear",duration:.5},children:[s==="mob"&&e.jsx(de,{}),(C===!0||l.length!==0)&&s==="lap"&&e.jsxs("div",{className:"suggestedUserDiv",children:[e.jsx("div",{className:"suggestedUserDiv1",children:e.jsx("p",{children:"Suggested for you"})}),e.jsx("div",{className:"suggestedUserDiv2",children:C?e.jsx(e.Fragment,{children:w.map((a,o)=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"suggestedLoaderCard",children:[e.jsx("div",{style:{animationDelay:`${o*.1}s`},className:"suggestedLoaderCard1"}),e.jsxs("div",{className:"suggestedLoaderCard2",children:[e.jsx("p",{style:{animationDelay:`${o*.1}s`}}),e.jsx("p",{style:{animationDelay:`${o*.1}s`}})]})]},o)}))}):e.jsx(e.Fragment,{children:l.map((a,o)=>e.jsx(W,{item:a},o))})})]}),e.jsxs("div",{className:"homeCenter",children:[e.jsx("div",{className:"homeCenter1",children:e.jsx("p",{children:"Suggested Posts"})}),e.jsxs("div",{className:"homeCenter2",ref:n,children:[u.map((a,o)=>e.jsx(q,{post:a,mute:d,handleMute:S},o)),p&&e.jsx(ue,{})]})]})]})};export{he as default};
